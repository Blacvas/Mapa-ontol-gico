<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Mapa ontológico: El laberinto de la soledad</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.js"></script>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Arial', sans-serif; }
        #info {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="info">Conceptos y relaciones de <em>El laberinto de la soledad</em> – Pulsa en un nodo para ver detalles</div>
    <script>
        // Definición de nodos y aristas
        let nodes = [];
        let edges = [];

        function setup() {
            createCanvas(1300, 800);
            textSize(12);
            textAlign(CENTER, CENTER);
            ellipseMode(CENTER);
            
            // Crear nodos con posiciones predefinidas (diseño radial)
            // Centro
            nodes.push({ id: 'soledad', label: 'La Soledad', x: 650, y: 400, color: color(255, 215, 0), size: 30, desc: 'Fondo último de la condición humana, orfandad y ruptura con el Todo.' });
            
            // Segundo nivel (radio 150)
            let r2 = 150;
            nodes.push({ id: 'mexicano', label: 'El Mexicano', x: 650 + r2, y: 400, color: color(144, 238, 144), size: 24, desc: 'Hermetismo, máscaras, ideal de "no rajarse".' });
            nodes.push({ id: 'historia', label: 'La Historia de México', x: 650 + r2 * cos(radians(60)), y: 400 - r2 * sin(radians(60)), color: color(144, 238, 144), size: 24, desc: 'Ciclo de rupturas y búsquedas de filiación.' });
            nodes.push({ id: 'fiesta', label: 'La Fiesta', x: 650 + r2 * cos(radians(120)), y: 400 - r2 * sin(radians(120)), color: color(144, 238, 144), size: 24, desc: 'Comunión, estallido del silencio, regreso al caos.' });
            nodes.push({ id: 'muerte', label: 'La Muerte', x: 650 - r2, y: 400, color: color(144, 238, 144), size: 24, desc: 'Espejo de la vida, frecuentada pero sin entrega.' });
            
            // Tercer nivel: arquetipos (radio 250)
            let r3 = 250;
            nodes.push({ id: 'chingada', label: 'La Chingada', x: 650 + r3 * cos(radians(0)), y: 400 - r3 * sin(radians(0)), color: color(255, 160, 122), size: 20, desc: 'Madre violada, pasividad, trauma de la Conquista.' });
            nodes.push({ id: 'macho', label: 'El Macho', x: 650 + r3 * cos(radians(30)), y: 400 - r3 * sin(radians(30)), color: color(255, 160, 122), size: 20, desc: 'Polo masculino, poder arbitrario que hiere.' });
            nodes.push({ id: 'malinche', label: 'La Malinche', x: 650 + r3 * cos(radians(60)), y: 400 - r3 * sin(radians(60)), color: color(255, 160, 122), size: 20, desc: 'Símbolo de entrega y traición, Eva mexicana.' });
            nodes.push({ id: 'cuauhtemoc', label: 'Cuauhtémoc', x: 650 + r3 * cos(radians(90)), y: 400 - r3 * sin(radians(90)), color: color(255, 160, 122), size: 20, desc: 'Héroe caído, origen mítico de la nación.' });
            nodes.push({ id: 'pachuco', label: 'El Pachuco', x: 650 + r3 * cos(radians(120)), y: 400 - r3 * sin(radians(120)), color: color(255, 160, 122), size: 20, desc: 'Extremo de identidad, híbrido que no quiere ser.' });
            nodes.push({ id: 'virgen', label: 'Virgen de Guadalupe', x: 650 + r3 * cos(radians(150)), y: 400 - r3 * sin(radians(150)), color: color(255, 160, 122), size: 20, desc: 'Madre de los huérfanos, refugio de los desamparados.' });
            
            // Tercer nivel: eventos históricos (radio 250, ángulos opuestos)
            nodes.push({ id: 'conquista', label: 'La Conquista', x: 650 + r3 * cos(radians(180)), y: 400 - r3 * sin(radians(180)), color: color(173, 216, 230), size: 20, desc: 'Violación, trauma, suicidio de los dioses.' });
            nodes.push({ id: 'colonia', label: 'La Colonia', x: 650 + r3 * cos(radians(210)), y: 400 - r3 * sin(radians(210)), color: color(173, 216, 230), size: 20, desc: 'Orden universal, participación religiosa, petrificación.' });
            nodes.push({ id: 'independencia', label: 'Independencia', x: 650 + r3 * cos(radians(240)), y: 400 - r3 * sin(radians(240)), color: color(173, 216, 230), size: 20, desc: 'Ruptura política, ambigüedad.' });
            nodes.push({ id: 'reforma', label: 'La Reforma', x: 650 + r3 * cos(radians(270)), y: 400 - r3 * sin(radians(270)), color: color(173, 216, 230), size: 20, desc: 'Negación del pasado, proyecto liberal.' });
            nodes.push({ id: 'revolucion', label: 'La Revolución', x: 650 + r3 * cos(radians(300)), y: 400 - r3 * sin(radians(300)), color: color(173, 216, 230), size: 20, desc: 'Regreso a los orígenes, búsqueda de sí mismo.' });
            nodes.push({ id: 'porfiriato', label: 'El Porfiriato', x: 650 + r3 * cos(radians(330)), y: 400 - r3 * sin(radians(330)), color: color(173, 216, 230), size: 20, desc: 'Simulación, positivismo como máscara.' });
            
            // Cuarto nivel: conceptos abstractos y figuras (radio 350)
            let r4 = 350;
            nodes.push({ id: 'mascara', label: 'Máscara', x: 650 + r4 * cos(radians(0)), y: 400 - r4 * sin(radians(0)), color: color(144, 238, 144), size: 16, desc: 'Defensa de la intimidad, simulación.' });
            nodes.push({ id: 'comunion', label: 'Comunión', x: 650 + r4 * cos(radians(20)), y: 400 - r4 * sin(radians(20)), color: color(144, 238, 144), size: 16, desc: 'Búsqueda de salir de la soledad (fiesta, amor).' });
            nodes.push({ id: 'ninguneo', label: 'Ninguneo', x: 650 + r4 * cos(radians(40)), y: 400 - r4 * sin(radians(40)), color: color(144, 238, 144), size: 16, desc: 'Hacer de alguien ninguno, negación del otro.' });
            nodes.push({ id: 'pasado', label: 'Pasado', x: 650 + r4 * cos(radians(60)), y: 400 - r4 * sin(radians(60)), color: color(144, 238, 144), size: 16, desc: 'Tradición indígena y colonial.' });
            nodes.push({ id: 'tradicion', label: 'Tradición', x: 650 + r4 * cos(radians(80)), y: 400 - r4 * sin(radians(80)), color: color(144, 238, 144), size: 16, desc: 'Herencia española e indígena.' });
            nodes.push({ id: 'norteamericano', label: 'Norteamericano', x: 650 + r4 * cos(radians(100)), y: 400 - r4 * sin(radians(100)), color: color(144, 238, 144), size: 16, desc: 'Activo, optimista, usa la realidad.' });
            nodes.push({ id: 'gesticulador', label: 'Gesticulador', x: 650 + r4 * cos(radians(120)), y: 400 - r4 * sin(radians(120)), color: color(144, 238, 144), size: 16, desc: 'Personaje que simula para ser auténtico (Usigli).' });
            nodes.push({ id: 'sorjuana', label: 'Sor Juana', x: 650 + r4 * cos(radians(140)), y: 400 - r4 * sin(radians(140)), color: color(255, 255, 100), size: 16, desc: 'Figura intelectual, soledad y conflicto.' });
            nodes.push({ id: 'prehispanico', label: 'México Prehispánico', x: 650 + r4 * cos(radians(160)), y: 400 - r4 * sin(radians(160)), color: color(210, 180, 140), size: 16, desc: 'Culturas originarias, base mítica.' });
            
            // Definir aristas (relaciones)
            // Nota: usamos índices para referenciar nodos por id
            edges.push({ from: 'soledad', to: 'comunion', label: '0.9 (tensión dialéctica)' });
            edges.push({ from: 'soledad', to: 'mexicano', label: 'fondo' });
            edges.push({ from: 'mexicano', to: 'mascara', label: '0.9 (defensa)' });
            edges.push({ from: 'mexicano', to: 'ninguneo', label: 'relación' });
            edges.push({ from: 'mexicano', to: 'norteamericano', label: '0.7 (oposición)', bidirectional: true });
            edges.push({ from: 'historia', to: 'conquista', label: 'hito' });
            edges.push({ from: 'historia', to: 'independencia', label: 'hito' });
            edges.push({ from: 'historia', to: 'reforma', label: 'hito' });
            edges.push({ from: 'historia', to: 'revolucion', label: 'hito' });
            edges.push({ from: 'conquista', to: 'chingada', label: '0.9 (violación)' });
            edges.push({ from: 'conquista', to: 'malinche', label: '0.8 (traición)' });
            edges.push({ from: 'conquista', to: 'cuauhtemoc', label: '0.8 (resistencia)' });
            edges.push({ from: 'conquista', to: 'colonia', label: 'consecuencia' });
            edges.push({ from: 'conquista', to: 'prehispanico', label: 'destrucción' });
            edges.push({ from: 'colonia', to: 'virgen', label: 'culto' });
            edges.push({ from: 'colonia', to: 'sorjuana', label: 'figura' });
            edges.push({ from: 'reforma', to: 'tradicion', label: '0.8 (negación)' });
            edges.push({ from: 'revolucion', to: 'pasado', label: '0.8 (regreso)' });
            edges.push({ from: 'revolucion', to: 'prehispanico', label: 'inspiración' });
            edges.push({ from: 'macho', to: 'chingada', label: 'acción de chingar' });
            edges.push({ from: 'malinche', to: 'chingada', label: 'identificación' });
            edges.push({ from: 'virgen', to: 'chingada', label: 'oposición' });
            edges.push({ from: 'fiesta', to: 'comunion', label: 'representa' });
            edges.push({ from: 'muerte', to: 'mexicano', label: 'espejo' });
            edges.push({ from: 'pachuco', to: 'mexicano', label: 'extremo' });
            edges.push({ from: 'pachuco', to: 'norteamericano', label: 'rechazo' });
            edges.push({ from: 'independencia', to: 'reforma', label: 'precede' });
            edges.push({ from: 'porfiriato', to: 'revolucion', label: 'causa' });
            edges.push({ from: 'pasado', to: 'colonia', label: 'conexión' });
            edges.push({ from: 'pasado', to: 'prehispanico', label: 'raíz' });
            edges.push({ from: 'tradicion', to: 'colonia', label: 'hereda' });
            edges.push({ from: 'tradicion', to: 'prehispanico', label: 'hereda' });
            edges.push({ from: 'gesticulador', to: 'mascara', label: 'simulación' });
            
            noLoop(); // Dibujar una vez estático
        }

        function draw() {
            background(245, 245, 240);
            
            // Dibujar aristas primero
            stroke(100, 100, 100, 80);
            strokeWeight(1);
            for (let e of edges) {
                let fromNode = nodes.find(n => n.id === e.from);
                let toNode = nodes.find(n => n.id === e.to);
                if (fromNode && toNode) {
                    line(fromNode.x, fromNode.y, toNode.x, toNode.y);
                    // Dibujar etiqueta de la arista en el punto medio
                    let midX = (fromNode.x + toNode.x) / 2;
                    let midY = (fromNode.y + toNode.y) / 2;
                    // Desplazar ligeramente para evitar superposición
                    let dx = toNode.x - fromNode.x;
                    let dy = toNode.y - fromNode.y;
                    let angle = atan2(dy, dx);
                    let offset = 15;
                    let labelX = midX + cos(angle + HALF_PI) * offset;
                    let labelY = midY + sin(angle + HALF_PI) * offset;
                    fill(80, 80, 80, 200);
                    noStroke();
                    textSize(9);
                    text(e.label, labelX, labelY);
                }
            }
            
            // Dibujar nodos
            for (let n of nodes) {
                // Sombra
                fill(0, 0, 0, 20);
                noStroke();
                ellipse(n.x + 2, n.y + 2, n.size + 2, n.size + 2);
                // Círculo
                fill(n.color);
                stroke(50);
                strokeWeight(1);
                ellipse(n.x, n.y, n.size, n.size);
                // Etiqueta
                fill(20);
                noStroke();
                textSize(n.size > 20 ? 12 : 10);
                text(n.label, n.x, n.y - n.size/2 - 5);
            }
            
            // Detectar hover y mostrar descripción
            let mouseOver = false;
            for (let n of nodes) {
                let d = dist(mouseX, mouseY, n.x, n.y);
                if (d < n.size/2) {
                    mouseOver = true;
                    fill(0, 0, 0, 220);
                    noStroke();
                    rect(mouseX + 10, mouseY - 30, 200, 40, 5);
                    fill(255);
                    textSize(11);
                    textAlign(LEFT, TOP);
                    text(n.desc, mouseX + 15, mouseY - 25, 190, 40);
                    textAlign(CENTER, CENTER);
                    break;
                }
            }
            if (!mouseOver) {
                // Mostrar instrucción
                fill(0, 0, 0, 150);
                textSize(11);
                textAlign(LEFT, TOP);
                text("Pasa el ratón sobre un nodo para ver su descripción.", 20, 20);
            }
        }

        // Redibujar cuando el ratón se mueve para actualizar hover
        function mouseMoved() {
            redraw();
        }
    </script>
</body>
</html>