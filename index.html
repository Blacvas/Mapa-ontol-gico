<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Mapa ontológico: El laberinto de la soledad</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.10.0/p5.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Arial', sans-serif; }
        #info {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 14px;
            pointer-events: none;
            z-index: 10;
        }
        #instruccion {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255,255,255,0.8);
            color: #333;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>
    <div id="info">Conceptos y relaciones de <em>El laberinto de la soledad</em></div>
    <div id="instruccion">Pasa el ratón sobre un nodo para ver su descripción</div>
    <script>
        let nodes = [];
        let edges = [];

        function setup() {
            createCanvas(1300, 800);
            textSize(12);
            textAlign(CENTER, CENTER);
            ellipseMode(CENTER);
            
            // -------------------- Nodos --------------------
            // Nodo central
            nodes.push(crearNodo('soledad', 'La Soledad', 650, 400, color(255, 215, 0), 30, 
                'Fondo último de la condición humana, orfandad y ruptura con el Todo.'));

            // Segundo nivel (radio 150)
            let r2 = 150;
            nodes.push(crearNodo('mexicano', 'El Mexicano', 650 + r2, 400, color(144, 238, 144), 24,
                'Hermetismo, máscaras, ideal de "no rajarse".'));
            nodes.push(crearNodo('historia', 'La Historia de México', 650 + r2 * cos(radians(60)), 400 - r2 * sin(radians(60)), color(144, 238, 144), 24,
                'Ciclo de rupturas y búsquedas de filiación.'));
            nodes.push(crearNodo('fiesta', 'La Fiesta', 650 + r2 * cos(radians(120)), 400 - r2 * sin(radians(120)), color(144, 238, 144), 24,
                'Comunión, estallido del silencio, regreso al caos.'));
            nodes.push(crearNodo('muerte', 'La Muerte', 650 - r2, 400, color(144, 238, 144), 24,
                'Espejo de la vida, frecuentada pero sin entrega.'));

            // Tercer nivel: arquetipos (radio 250)
            let r3 = 250;
            nodes.push(crearNodo('chingada', 'La Chingada', 650 + r3 * cos(radians(0)), 400 - r3 * sin(radians(0)), color(255, 160, 122), 20,
                'Madre violada, pasividad, trauma de la Conquista.'));
            nodes.push(crearNodo('macho', 'El Macho', 650 + r3 * cos(radians(30)), 400 - r3 * sin(radians(30)), color(255, 160, 122), 20,
                'Polo masculino, poder arbitrario que hiere.'));
            nodes.push(crearNodo('malinche', 'La Malinche', 650 + r3 * cos(radians(60)), 400 - r3 * sin(radians(60)), color(255, 160, 122), 20,
                'Símbolo de entrega y traición, Eva mexicana.'));
            nodes.push(crearNodo('cuauhtemoc', 'Cuauhtémoc', 650 + r3 * cos(radians(90)), 400 - r3 * sin(radians(90)), color(255, 160, 122), 20,
                'Héroe caído, origen mítico de la nación.'));
            nodes.push(crearNodo('pachuco', 'El Pachuco', 650 + r3 * cos(radians(120)), 400 - r3 * sin(radians(120)), color(255, 160, 122), 20,
                'Extremo de identidad, híbrido que no quiere ser.'));
            nodes.push(crearNodo('virgen', 'Virgen de Guadalupe', 650 + r3 * cos(radians(150)), 400 - r3 * sin(radians(150)), color(255, 160, 122), 20,
                'Madre de los huérfanos, refugio de los desamparados.'));

            // Tercer nivel: eventos históricos (radio 250, ángulos opuestos)
            nodes.push(crearNodo('conquista', 'La Conquista', 650 + r3 * cos(radians(180)), 400 - r3 * sin(radians(180)), color(173, 216, 230), 20,
                'Violación, trauma, suicidio de los dioses.'));
            nodes.push(crearNodo('colonia', 'La Colonia', 650 + r3 * cos(radians(210)), 400 - r3 * sin(radians(210)), color(173, 216, 230), 20,
                'Orden universal, participación religiosa, petrificación.'));
            nodes.push(crearNodo('independencia', 'Independencia', 650 + r3 * cos(radians(240)), 400 - r3 * sin(radians(240)), color(173, 216, 230), 20,
                'Ruptura política, ambigüedad.'));
            nodes.push(crearNodo('reforma', 'La Reforma', 650 + r3 * cos(radians(270)), 400 - r3 * sin(radians(270)), color(173, 216, 230), 20,
                'Negación del pasado, proyecto liberal.'));
            nodes.push(crearNodo('revolucion', 'La Revolución', 650 + r3 * cos(radians(300)), 400 - r3 * sin(radians(300)), color(173, 216, 230), 20,
                'Regreso a los orígenes, búsqueda de sí mismo.'));
            nodes.push(crearNodo('porfiriato', 'El Porfiriato', 650 + r3 * cos(radians(330)), 400 - r3 * sin(radians(330)), color(173, 216, 230), 20,
                'Simulación, positivismo como máscara.'));

            // Cuarto nivel: conceptos abstractos y figuras (radio 350)
            let r4 = 350;
            nodes.push(crearNodo('mascara', 'Máscara', 650 + r4 * cos(radians(0)), 400 - r4 * sin(radians(0)), color(144, 238, 144), 16,
                'Defensa de la intimidad, simulación.'));
            nodes.push(crearNodo('comunion', 'Comunión', 650 + r4 * cos(radians(20)), 400 - r4 * sin(radians(20)), color(144, 238, 144), 16,
                'Búsqueda de salir de la soledad (fiesta, amor).'));
            nodes.push(crearNodo('ninguneo', 'Ninguneo', 650 + r4 * cos(radians(40)), 400 - r4 * sin(radians(40)), color(144, 238, 144), 16,
                'Hacer de alguien ninguno, negación del otro.'));
            nodes.push(crearNodo('pasado', 'Pasado', 650 + r4 * cos(radians(60)), 400 - r4 * sin(radians(60)), color(144, 238, 144), 16,
                'Tradición indígena y colonial.'));
            nodes.push(crearNodo('tradicion', 'Tradición', 650 + r4 * cos(radians(80)), 400 - r4 * sin(radians(80)), color(144, 238, 144), 16,
                'Herencia española e indígena.'));
            nodes.push(crearNodo('norteamericano', 'Norteamericano', 650 + r4 * cos(radians(100)), 400 - r4 * sin(radians(100)), color(144, 238, 144), 16,
                'Activo, optimista, usa la realidad.'));
            nodes.push(crearNodo('gesticulador', 'Gesticulador', 650 + r4 * cos(radians(120)), 400 - r4 * sin(radians(120)), color(144, 238, 144), 16,
                'Personaje que simula para ser auténtico (Usigli).'));
            nodes.push(crearNodo('sorjuana', 'Sor Juana', 650 + r4 * cos(radians(140)), 400 - r4 * sin(radians(140)), color(255, 255, 100), 16,
                'Figura intelectual, soledad y conflicto.'));
            nodes.push(crearNodo('prehispanico', 'México Prehispánico', 650 + r4 * cos(radians(160)), 400 - r4 * sin(radians(160)), color(210, 180, 140), 16,
                'Culturas originarias, base mítica.'));

            // -------------------- Aristas --------------------
            function addEdge(from, to, label) {
                edges.push({ from: from, to: to, label: label });
            }

            addEdge('soledad', 'comunion', '0.9 (tensión dialéctica)');
            addEdge('soledad', 'mexicano', 'fondo');
            addEdge('mexicano', 'mascara', '0.9 (defensa)');
            addEdge('mexicano', 'ninguneo', 'relación');
            addEdge('mexicano', 'norteamericano', '0.7 (oposición)');
            addEdge('norteamericano', 'mexicano', '0.7 (oposición)');
            addEdge('historia', 'conquista', 'hito');
            addEdge('historia', 'independencia', 'hito');
            addEdge('historia', 'reforma', 'hito');
            addEdge('historia', 'revolucion', 'hito');
            addEdge('conquista', 'chingada', '0.9 (violación)');
            addEdge('conquista', 'malinche', '0.8 (traición)');
            addEdge('conquista', 'cuauhtemoc', '0.8 (resistencia)');
            addEdge('conquista', 'colonia', 'consecuencia');
            addEdge('conquista', 'prehispanico', 'destrucción');
            addEdge('colonia', 'virgen', 'culto');
            addEdge('colonia', 'sorjuana', 'figura');
            addEdge('reforma', 'tradicion', '0.8 (negación)');
            addEdge('revolucion', 'pasado', '0.8 (regreso)');
            addEdge('revolucion', 'prehispanico', 'inspiración');
            addEdge('macho', 'chingada', 'acción de chingar');
            addEdge('malinche', 'chingada', 'identificación');
            addEdge('virgen', 'chingada', 'oposición');
            addEdge('fiesta', 'comunion', 'representa');
            addEdge('muerte', 'mexicano', 'espejo');
            addEdge('pachuco', 'mexicano', 'extremo');
            addEdge('pachuco', 'norteamericano', 'rechazo');
            addEdge('independencia', 'reforma', 'precede');
            addEdge('porfiriato', 'revolucion', 'causa');
            addEdge('pasado', 'colonia', 'conexión');
            addEdge('pasado', 'prehispanico', 'raíz');
            addEdge('tradicion', 'colonia', 'hereda');
            addEdge('tradicion', 'prehispanico', 'hereda');
            addEdge('gesticulador', 'mascara', 'simulación');

            noLoop();
        }

        // Función auxiliar para crear nodos con valores por defecto seguros
        function crearNodo(id, label, x, y, col, sz, desc) {
            return {
                id: id,
                label: label || '',
                x: x,
                y: y,
                color: col,
                size: sz,
                desc: desc || 'Sin descripción'
            };
        }

        function draw() {
            background(245, 245, 240);
            
            // Dibujar aristas
            stroke(100, 100, 100, 80);
            strokeWeight(1);
            for (let e of edges) {
                let fromNode = nodes.find(n => n.id === e.from);
                let toNode = nodes.find(n => n.id === e.to);
                if (fromNode && toNode) {
                    line(fromNode.x, fromNode.y, toNode.x, toNode.y);
                    
                    // Etiqueta de la arista en el punto medio con desplazamiento
                    let midX = (fromNode.x + toNode.x) / 2;
                    let midY = (fromNode.y + toNode.y) / 2;
                    let dx = toNode.x - fromNode.x;
                    let dy = toNode.y - fromNode.y;
                    let angle = atan2(dy, dx);
                    let offset = 15;
                    let labelX = midX + cos(angle + HALF_PI) * offset;
                    let labelY = midY + sin(angle + HALF_PI) * offset;
                    
                    fill(80, 80, 80, 200);
                    noStroke();
                    textSize(9);
                    text(e.label, labelX, labelY);
                }
            }
            
            // Dibujar nodos
            for (let n of nodes) {
                // Sombra
                fill(0, 0, 0, 20);
                noStroke();
                ellipse(n.x + 2, n.y + 2, n.size + 2, n.size + 2);
                // Círculo
                fill(n.color);
                stroke(50);
                strokeWeight(1);
                ellipse(n.x, n.y, n.size, n.size);
                // Etiqueta del nodo
                fill(20);
                noStroke();
                textSize(n.size > 20 ? 12 : 10);
                text(n.label, n.x, n.y - n.size/2 - 5);
            }
            
            // Mostrar descripción al pasar el ratón
            let nodoCerca = null;
            for (let n of nodes) {
                let d = dist(mouseX, mouseY, n.x, n.y);
                if (d < n.size/2) {
                    nodoCerca = n;
                    break;
                }
            }
            
            if (nodoCerca) {
                // Fondo para el texto
                fill(0, 0, 0, 220);
                noStroke();
                rect(mouseX + 15, mouseY - 35, 220, 45, 5);
                fill(255);
                textSize(11);
                textAlign(LEFT, TOP);
                text(nodoCerca.desc, mouseX + 20, mouseY - 30, 210, 40);
                textAlign(CENTER, CENTER);
            }
        }

        function mouseMoved() {
            redraw();
        }
    </script>
</body>
</html>
